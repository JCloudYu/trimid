"use strict";const FNV_PRIME_HIGH=256,FNV_PRIME_LOW=403,OFFSET_BASIS=new Uint8Array([197,157,28,129]),IS_NODEJS="undefined"!=typeof Buffer,TIME_SEPARATOR=4294967296,RUNTIME={SEQ:Math.floor(16777215*Math.random()),SID:null,MACHINE_ID:null};if(IS_NODEJS){const e=require("worker_threads");RUNTIME.MACHINE_ID=fnv1a32(UTF8Encode(require("os").hostname()));const t=`${process.pid.toString().padStart(5,"0")}#${process.ppid.toString().padStart(5,"0")}.`+(e.isMainThread?1:e.threadId).toString().padStart(5,"0");RUNTIME.SID=fnv1a32(UTF8Encode(t))}else{const e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWZYZ_-";let t="";if("object"==typeof location&&"string"==typeof location.hostname)t=location.hostname;else{let r=30*Math.random()+30;for(;r-- >0;)t+=e[Math.random()*e.length|0]}let r="";{let t=30*Math.random()+30;for(;t-- >0;)r+=e[Math.random()*e.length|0]}RUNTIME.MACHINE_ID=fnv1a32(UTF8Encode(t)),RUNTIME.SID=fnv1a32(UTF8Encode(r))}const PRIVATE=new WeakMap;class TrimId{constructor(e){let t=null;e instanceof TrimId?t=PRIVATE.get(e).buffer:e instanceof Uint8Array?t=e:ArrayBuffer.isView(e)?t=new Uint8Array(e.buffer):e instanceof ArrayBuffer&&(t=new Uint8Array(e));let r=null;if(t){if(t.length<16)throw new TypeError("Given input buffer must be at least 14 bytes long!");r=new Uint8Array(t.slice(0,16))}else{let t;if("number"==typeof e){if(e<0)throw new RangeError("Input number must be greater or equal to 0");t=Math.floor(e)}else t=Math.floor(Date.now()/1e3);const n=Math.floor(t/4294967296),E=t%4294967296,o=RUNTIME.SEQ=RUNTIME.SEQ+1&16777215,i=new Uint8Array(16);i[0]=255&n,i[1]=E>>>24&255,i[2]=E>>>16&255,i[3]=E>>>8&255,i[4]=255&E,i[5]=RUNTIME.MACHINE_ID[0],i[6]=RUNTIME.MACHINE_ID[1],i[7]=RUNTIME.MACHINE_ID[2],i[8]=RUNTIME.MACHINE_ID[3],i[9]=RUNTIME.SID[0],i[10]=RUNTIME.SID[1],i[11]=RUNTIME.SID[2],i[12]=RUNTIME.SID[3],i[13]=o>>>16&255,i[14]=o>>>8&255,i[15]=255&o,r=i}const n=Object.create(null);n.buffer=r,PRIVATE.set(this,n)}toString(e=64){const t=PRIVATE.get(this).buffer;switch(e){case 64:return Base64SortEncode(t);case 32:return Base32HexEncode(t);case 16:return HexEncode(t);default:throw new SyntaxError(`Cannot cast unique-id as \`${e}\``)}}toJSON(){return this.toString()}toBytes(){return PRIVATE.get(this).buffer.slice(0)}get bytes(){return PRIVATE.get(this).buffer}get timestamp(){const e=PRIVATE.get(this).buffer;return 4294967296*e[0]+((e[1]<<24|e[2]<<16|e[3]<<8|e[4])>>>0)}get machine_id(){const e=PRIVATE.get(this).buffer;return(e[5]<<24|e[6]<<16|e[7]<<8|e[8])>>>0}get session_id(){const e=PRIVATE.get(this).buffer;return(e[9]<<24|e[10]<<16|e[11]<<8|e[12])>>>0}get seq(){const e=PRIVATE.get(this).buffer;return(e[13]<<16|e[14]<<8|e[15])>>>0}static get NEW(){return new TrimId}static from(e){try{return new TrimId(e)}catch(e){return null}}static fromHex(e){try{const t=HexDecode(e);return new TrimId(t)}catch(e){return null}}static fromBase64Sort(e){try{const t=Base64SortDecode(e);return new TrimId(t)}catch(e){return null}}static fromBase32Hex(e){try{const t=Base32HexDecode(e);return new TrimId(t)}catch(e){return null}}}const HEX_ENCODE_CHAR="0123456789abcdef",HEX_DECODE_CHAR={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15};function HexEncode(e){let t="";for(let r=0;r<e.length;r++){const n=e[r];t+=HEX_ENCODE_CHAR[(240&n)>>>4]+HEX_ENCODE_CHAR[15&n]}return t}function HexDecode(e){e.length%2==1&&(e="0"+e);const t=new Uint8Array(e.length/2|0);for(let r=0;r<t.length;r++){const n=2*r,E=HEX_DECODE_CHAR[e[n]],o=HEX_DECODE_CHAR[e[n+1]];if(void 0===E||void 0===o)throw new RangeError("Given input string is not hex encoded!");t[r]=E<<4|15&o}return t}const BASE64SORT_ENCODE_CHAR="0123456789=ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz".split(""),BASE64SORT_DECODE_CHAR={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,"=":10,A:11,B:12,C:13,D:14,E:15,F:16,G:17,H:18,I:19,J:20,K:21,L:22,M:23,N:24,O:25,P:26,Q:27,R:28,S:29,T:30,U:31,V:32,W:33,X:34,Y:35,Z:36,_:37,a:38,b:39,c:40,d:41,e:42,f:43,g:44,h:45,i:46,j:47,k:48,l:49,m:50,n:51,o:52,p:53,q:54,r:55,s:56,t:57,u:58,v:59,w:60,x:61,y:62,z:63};function Base64SortEncode(e){for(var t,r,n,E="",o=e.length,i=0,s=3*(o/3>>>0);i<s;)t=e[i++],r=e[i++],n=e[i++],E+=BASE64SORT_ENCODE_CHAR[t>>>2]+BASE64SORT_ENCODE_CHAR[63&(t<<4|r>>>4)]+BASE64SORT_ENCODE_CHAR[63&(r<<2|n>>>6)]+BASE64SORT_ENCODE_CHAR[63&n];var A=o-s;return 1===A?(t=e[i],E+=BASE64SORT_ENCODE_CHAR[t>>>2]+BASE64SORT_ENCODE_CHAR[t<<4&63]+""):2===A&&(t=e[i++],r=e[i],E+=BASE64SORT_ENCODE_CHAR[t>>>2]+BASE64SORT_ENCODE_CHAR[63&(t<<4|r>>>4)]+BASE64SORT_ENCODE_CHAR[r<<2&63]+""),E}function Base64SortDecode(e){let t;const r=(e=""+e).length,n=r%4;switch(n){case 0:t=3*(r/4|0);break;case 2:t=3*(r/4|0)+1;break;case 3:t=3*(r/4|0)+2;break;default:throw new Error("Given input string is not base64sort encoded!")}const E=new Uint8Array(t);let o,i,s,A,a=0,_=0,C=4*(r/4|0);for(;a<C;){if(o=BASE64SORT_DECODE_CHAR[e[a++]],i=BASE64SORT_DECODE_CHAR[e[a++]],s=BASE64SORT_DECODE_CHAR[e[a++]],A=BASE64SORT_DECODE_CHAR[e[a++]],void 0===o||void 0===i||void 0===s||void 0===A)throw new Error("Given input string is not base64sort encoded!");E[_++]=o<<2|i>>>4,E[_++]=i<<4|s>>>2,E[_++]=s<<6|A}switch(n){case 2:if(o=BASE64SORT_DECODE_CHAR[e.charAt(a++)],i=BASE64SORT_DECODE_CHAR[e.charAt(a)],void 0===o||void 0===i)throw new Error("Given input string is not base64sort encoded!");E[_]=o<<2|i>>>4;break;case 3:if(o=BASE64SORT_DECODE_CHAR[e.charAt(a++)],i=BASE64SORT_DECODE_CHAR[e.charAt(a++)],s=BASE64SORT_DECODE_CHAR[e.charAt(a)],void 0===o||void 0===i||void 0===s)throw new Error("Given input string is not base64sort encoded!");E[_]=o<<2|i>>>4,E[_+1]=i<<4|s>>>2}return E}const BASE32_ENCODE_CHAR="0123456789abcdefghijklmnopqrstuv".split(""),BASE32_DECODE_CHAR={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,I:18,J:19,K:20,L:21,M:22,N:23,O:24,P:25,Q:26,R:27,S:28,T:29,U:30,V:31,a:10,b:11,c:12,d:13,e:14,f:15,g:16,h:17,i:18,j:19,k:20,l:21,m:22,n:23,o:24,p:25,q:26,r:27,s:28,t:29,u:30,v:31};function Base32HexEncode(e){if(e.length<1)return"";let t,r="",n=Math.floor(e.length/5);for(let E=0;E<n;E++)t=5*E,r+=BASE32_ENCODE_CHAR[e[t]>>3],r+=BASE32_ENCODE_CHAR[(7&e[t])<<2|e[t+1]>>6],r+=BASE32_ENCODE_CHAR[(62&e[t+1])>>1],r+=BASE32_ENCODE_CHAR[(1&e[t+1])<<4|e[t+2]>>4],r+=BASE32_ENCODE_CHAR[(15&e[t+2])<<1|e[t+3]>>7],r+=BASE32_ENCODE_CHAR[(124&e[t+3])>>2],r+=BASE32_ENCODE_CHAR[(3&e[t+3])<<3|e[t+4]>>5],r+=BASE32_ENCODE_CHAR[31&e[t+4]];let E=e.length%5;return 0===E||(t=5*n,1===E?(r+=BASE32_ENCODE_CHAR[e[t]>>3],r+=BASE32_ENCODE_CHAR[(7&e[t])<<2]):2===E?(r+=BASE32_ENCODE_CHAR[e[t]>>3],r+=BASE32_ENCODE_CHAR[(7&e[t])<<2|e[t+1]>>6],r+=BASE32_ENCODE_CHAR[(62&e[t+1])>>1],r+=BASE32_ENCODE_CHAR[(1&e[t+1])<<4]):3===E?(r+=BASE32_ENCODE_CHAR[e[t]>>3],r+=BASE32_ENCODE_CHAR[(7&e[t])<<2|e[t+1]>>6],r+=BASE32_ENCODE_CHAR[(62&e[t+1])>>1],r+=BASE32_ENCODE_CHAR[(1&e[t+1])<<4|e[t+2]>>4],r+=BASE32_ENCODE_CHAR[(15&e[t+2])<<1]):4===E&&(r+=BASE32_ENCODE_CHAR[e[t]>>3],r+=BASE32_ENCODE_CHAR[(7&e[t])<<2|e[t+1]>>6],r+=BASE32_ENCODE_CHAR[(62&e[t+1])>>1],r+=BASE32_ENCODE_CHAR[(1&e[t+1])<<4|e[t+2]>>4],r+=BASE32_ENCODE_CHAR[(15&e[t+2])<<1|e[t+3]>>7],r+=BASE32_ENCODE_CHAR[(124&e[t+3])>>2],r+=BASE32_ENCODE_CHAR[(3&e[t+3])<<3])),r}function Base32HexDecode(e){let t=e.length%8;if([0,2,4,5,7].indexOf(t)<0)throw new Error("Given input string is not base32hex encoded!");let r,n,E=new Uint8Array(Math.floor(5*e.length/8)),o=Math.floor(e.length/8);for(let t=0;t<o;t++){n=8*t,r=5*t;const o=BASE32_DECODE_CHAR[e[n]],i=BASE32_DECODE_CHAR[e[n+1]],s=BASE32_DECODE_CHAR[e[n+2]],A=BASE32_DECODE_CHAR[e[n+3]],a=BASE32_DECODE_CHAR[e[n+4]],_=BASE32_DECODE_CHAR[e[n+5]],C=BASE32_DECODE_CHAR[e[n+6]],c=BASE32_DECODE_CHAR[e[n+7]];if(void 0===o||void 0===i||void 0===s||void 0===A||void 0===a||void 0===_||void 0===C||void 0===c)throw new RangeError("Given input string is not base32hex encoded!");E[r]=o<<3|i>>2,E[r+1]=(3&i)<<6|s<<1|A>>4,E[r+2]=(15&A)<<4|a>>1,E[r+3]=(1&a)<<7|_<<2|C>>3,E[r+4]=(7&C)<<5|c}if(0===t)return E;{n=8*o,r=5*o;const i=BASE32_DECODE_CHAR[e[n]],s=BASE32_DECODE_CHAR[e[n+1]],A=BASE32_DECODE_CHAR[e[n+2]],a=BASE32_DECODE_CHAR[e[n+3]],_=BASE32_DECODE_CHAR[e[n+4]],C=BASE32_DECODE_CHAR[e[n+5]],c=BASE32_DECODE_CHAR[e[n+6]];if(t>=2){if(void 0===i||void 0===s)throw new RangeError("Given input string is not base32hex encoded!");E[r]=i<<3|s>>2}if(t>=4){if(void 0===A||void 0===a)throw new RangeError("Given input string is not base32hex encoded!");E[r+1]=(3&s)<<6|A<<1|a>>4}if(t>=5){if(void 0===_)throw new RangeError("Given input string is not base32hex encoded!");E[r+2]=(15&a)<<4|_>>1}if(7===t){if(void 0===C||void 0===c)throw new RangeError("Given input string is not base32hex encoded!");E[r+3]=(1&_)<<7|C<<2|c>>3}}return E}function UTF8Encode(e){if("string"!=typeof e)throw new TypeError("Given input argument must be a js string!");let t=[],r=0;for(;r<e.length;){let n=e.codePointAt(r);if(void 0===n)throw new Error(`Invalid codepoint at index#${r}!`);0==(4294967168&n)?t.push(n):0==(4294965248&n)?t.push(192|31&n>>6,128|63&n):0==(4294901760&n)?t.push(224|15&n>>12,128|63&n>>6,128|63&n):0==(4292870144&n)&&t.push(240|7&n>>18,128|63&n>>12,128|63&n>>6,128|63&n),r+=n>65535?2:1}return new Uint8Array(t)}function fnv1a32(e){const t=OFFSET_BASIS.slice(0),r=new Uint32Array(t.buffer),n=new Uint16Array(t.buffer);for(let t=0;t<e.length;t+=1){r[0]=r[0]^e[t];let E=n[0],o=n[1];n[0]=403*E,n[1]=256*E+403*o+(n[0]>>>16)}return t}(()=>{if(require.main===module){const e=process.argv.slice(2).reverse(),t={help:!1,binary:!1,base64sort:!1,base32hex:!1,hex:!1};for(;e.length>0;){switch(e.pop()){case"--help":t.help=!0;break;case"--binary":t.binary=!0;break;case"--b64sort":t.base64sort=!0;break;case"--b32hex":t.base32hex=!0;break;case"--hex":t.hex=!0}}if(t.help)return console.log("trimid [--b64sort] [--binary] [--hex]"),void process.exit(1);const r=TrimId.NEW;return t.base64sort?process.stdout.write(r.toString(64)+"\n"):t.hex?process.stdout.write(r.toString(16)+"\n"):t.binary?process.stdout.write(r.bytes):process.stdout.write(r.toString(32)+"\n"),void process.exit(0)}"undefined"==typeof module||Object(module)!==module?"undefined"==typeof global?"undefined"==typeof window||(window.TrimId=TrimId):global.TrimId=TrimId:module.exports=TrimId})();
