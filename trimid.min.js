#!/usr/bin/env node
"use strict";(()=>{"use strict";const e=256,n=403;const t=new Uint8Array([197,157,28,129]);const r=4294967295+1;const o={TID:Math.floor(Date.now()/1e3),SEQ:0,SID:null,MACHINE_ID:null,IDENTITY:null};{const e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWZYZ_-";let n="";if(typeof location==="object"&&typeof location.hostname==="string"){n=location.hostname}else{let t=Math.random()*30+30;while(t-- >0){n+=e[Math.random()*e.length|0]}}let t="";{let n=Math.random()*30+30;while(n-- >0){t+=e[Math.random()*e.length|0]}}const r=p(w(n));const i=p(w(t));o.MACHINE_ID=r;o.SID=i;o.IDENTITY=p(Uint8Array.from([r[0],r[1],r[2],r[3],i[0],i[1],i[2],i[3]]))}class i{static setup(e,n){if(typeof e==="string"){o.MACHINE_ID=p(w(e))}if(typeof n==="string"){o.SID=p(w(n))}o.IDENTITY=p(Uint8Array.from([o.MACHINE_ID[0],o.MACHINE_ID[1],o.MACHINE_ID[2],o.MACHINE_ID[3],o.SID[0],o.SID[1],o.SID[2],o.SID[3]]))}static get newLongId(){return this.longid()}static longid(e=62){const n=Math.floor(Date.now()/1e3);const t=Math.floor(n/r);const i=n%r;if(o.TID!==n){o.SEQ=0;o.TID=n}const s=o.SEQ=o.SEQ+1&16777215;const l=new Uint8Array(16);l[0]=t&255;l[1]=i>>>24&255;l[2]=i>>>16&255;l[3]=i>>>8&255;l[4]=i&255;l[5]=o.MACHINE_ID[0];l[6]=o.MACHINE_ID[1];l[7]=o.MACHINE_ID[2];l[8]=o.MACHINE_ID[3];l[9]=o.SID[0];l[10]=o.SID[1];l[11]=o.SID[2];l[12]=o.SID[3];l[13]=s>>>16&255;l[14]=s>>>8&255;l[15]=s&255;return e===16?I(l):e===32?f(l):d(l)}static get newShortId(){return this.shortid()}static shortid(e=62){const n=Math.floor(Date.now()/1e3);const t=Math.floor(n/r);const i=n%r;const s=o.IDENTITY;if(o.TID!==n){o.SEQ=0;o.TID=n}const l=o.SEQ=o.SEQ+1&65535;const a=new Uint8Array(11);a[0]=t&255;a[1]=i>>>24&255;a[2]=i>>>16&255;a[3]=i>>>8&255;a[4]=i&255;a[5]=s[0];a[6]=s[1];a[7]=s[2];a[8]=s[3];a[9]=l>>>8&255;a[10]=l&255;return e===16?I(a):e===32?f(a):d(a)}static read(e,n=62){const t=n===16?g(e):n===32?a(e):h(e);if(t.length===16){return{timestamp:t[0]<<32|t[1]<<24|t[2]<<16|t[3]<<8|t[4],machine_id:t[5]<<24|t[6]<<16|t[7]<<8|t[8],session_id:t[9]<<24|t[10]<<16|t[11]<<8|t[12],seq:t[13]<<16|t[14]<<8|t[15]}}if(t.length===11){return{timestamp:t[0]<<32|t[1]<<24|t[2]<<16|t[3]<<8|t[4],identity:t[5]<<24|t[6]<<16|t[7]<<8|t[8],seq:t[9]<<8|t[10]}}}}const s="0123456789abcdefghijklmnopqrstuv".split("");const l={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,I:18,J:19,K:20,L:21,M:22,N:23,O:24,P:25,Q:26,R:27,S:28,T:29,U:30,V:31,a:10,b:11,c:12,d:13,e:14,f:15,g:16,h:17,i:18,j:19,k:20,l:21,m:22,n:23,o:24,p:25,q:26,r:27,s:28,t:29,u:30,v:31};function f(e){if(e.length<1)return"";let n="";let t,r=Math.floor(e.length/5);for(let o=0;o<r;o++){t=o*5;n+=s[e[t]>>3];n+=s[(e[t]&7)<<2|e[t+1]>>6];n+=s[(e[t+1]&62)>>1];n+=s[(e[t+1]&1)<<4|e[t+2]>>4];n+=s[(e[t+2]&15)<<1|e[t+3]>>7];n+=s[(e[t+3]&124)>>2];n+=s[(e[t+3]&3)<<3|e[t+4]>>5];n+=s[e[t+4]&31]}let o=e.length%5;if(o===0){return n}t=r*5;if(o===1){n+=s[e[t]>>3];n+=s[(e[t]&7)<<2]}else if(o===2){n+=s[e[t]>>3];n+=s[(e[t]&7)<<2|e[t+1]>>6];n+=s[(e[t+1]&62)>>1];n+=s[(e[t+1]&1)<<4]}else if(o===3){n+=s[e[t]>>3];n+=s[(e[t]&7)<<2|e[t+1]>>6];n+=s[(e[t+1]&62)>>1];n+=s[(e[t+1]&1)<<4|e[t+2]>>4];n+=s[(e[t+2]&15)<<1]}else if(o===4){n+=s[e[t]>>3];n+=s[(e[t]&7)<<2|e[t+1]>>6];n+=s[(e[t+1]&62)>>1];n+=s[(e[t+1]&1)<<4|e[t+2]>>4];n+=s[(e[t+2]&15)<<1|e[t+3]>>7];n+=s[(e[t+3]&124)>>2];n+=s[(e[t+3]&3)<<3]}return n}function a(e){let n=e.length%8;if([0,2,4,5,7].indexOf(n)<0){throw new Error("Given input string is not base32hex encoded!")}let t=new Uint8Array(Math.floor(e.length*5/8));let r,o,i=Math.floor(e.length/8);for(let n=0;n<i;n++){o=n*8;r=n*5;const i=l[e[o]];const s=l[e[o+1]];const f=l[e[o+2]];const a=l[e[o+3]];const c=l[e[o+4]];const u=l[e[o+5]];const d=l[e[o+6]];const h=l[e[o+7]];if(i===undefined||s===undefined||f===undefined||a===undefined||c===undefined||u===undefined||d===undefined||h===undefined){throw new RangeError("Given input string is not base32hex encoded!")}t[r]=i<<3|s>>2;t[r+1]=(s&3)<<6|f<<1|a>>4;t[r+2]=(a&15)<<4|c>>1;t[r+3]=(c&1)<<7|u<<2|d>>3;t[r+4]=(d&7)<<5|h}if(n===0){return t}{o=i*8;r=i*5;const s=l[e[o]];const f=l[e[o+1]];const a=l[e[o+2]];const c=l[e[o+3]];const u=l[e[o+4]];const d=l[e[o+5]];const h=l[e[o+6]];if(n>=2){if(s===undefined||f===undefined){throw new RangeError("Given input string is not base32hex encoded!")}t[r]=s<<3|f>>2}if(n>=4){if(a===undefined||c===undefined){throw new RangeError("Given input string is not base32hex encoded!")}t[r+1]=(f&3)<<6|a<<1|c>>4}if(n>=5){if(u===undefined){throw new RangeError("Given input string is not base32hex encoded!")}t[r+2]=(c&15)<<4|u>>1}if(n===7){if(d===undefined||h===undefined){throw new RangeError("Given input string is not base32hex encoded!")}t[r+3]=(u&1)<<7|d<<2|h>>3}}return t}const c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";const u={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,I:18,J:19,K:20,L:21,M:22,N:23,O:24,P:25,Q:26,R:27,S:28,T:29,U:30,V:31,W:32,X:33,Y:34,Z:35,a:36,b:37,c:38,d:39,e:40,f:41,g:42,h:43,i:44,j:45,k:46,l:47,m:48,n:49,o:50,p:51,q:52,r:53,s:54,t:55,u:56,v:57,w:58,x:59,y:60,z:61};function d(e){if(e.length<1)return"";let n=0n,t=0;for(let r=0;r<e.length;r++){if(r===t&&e[r]===0){t++}n=n*256n+BigInt(e[r])}let r=[];while(n>0n){const e=Number(n%62n);n=n/62n;r.push(c[e])}for(let e=0;e<t;e++){r.push("0")}return r.reverse().join("")}function h(e){if(e.length<1)return new Uint8Array(0);let n=0;for(let t=0;t<e.length&&e[t]==="0";t++){n++}let t=0n;for(let r=n;r<e.length;r++){const n=e[r];const o=u[n];if(o===undefined){throw new Error("Invalid Base62 character: "+n)}t=t*62n+BigInt(o)}const r=[];while(t>0n){r.push(Number(t%256n));t=t/256n}for(let e=0;e<n;e++){r.push(0)}return new Uint8Array(r.reverse())}function I(e){const n="0123456789abcdef";let t="";for(let r=0;r<e.length;r++){const o=e[r];t+=n[o>>4&15];t+=n[o&15]}return t}function g(e){if(e.length%2!==0){throw new Error("Invalid Base16 string length")}const n=new Uint8Array(e.length/2);for(let t=0;t<e.length;t+=2){const r=parseInt(e[t],16);const o=parseInt(e[t+1],16);if(isNaN(r)||isNaN(o)){throw new Error("Invalid Base16 character")}n[t/2]=r<<4|o}return n}function w(e){if(typeof e!=="string"){throw new TypeError("Given input argument must be a js string!")}let n=[];let t=0;while(t<e.length){let r=e.codePointAt(t);if(r===undefined){throw new Error(`Invalid codepoint at index#${t}!`)}if((r&4294967168)===0){n.push(r)}else if((r&4294965248)===0){n.push(192|31&r>>6,128|63&r)}else if((r&4294901760)===0){n.push(224|15&r>>12,128|63&r>>6,128|63&r)}else if((r&4292870144)===0){n.push(240|7&r>>18,128|63&r>>12,128|63&r>>6,128|63&r)}t+=r>65535?2:1}return new Uint8Array(n)}function p(r){const o=t.slice(0);const i=new Uint32Array(o.buffer);const s=new Uint16Array(o.buffer);for(let t=0;t<r.length;t+=1){i[0]=i[0]^r[t];let o=s[0],l=s[1];s[0]=o*n;s[1]=o*e+l*n+(s[0]>>>16)}return o}if(typeof require!=="undefined"&&require.main===module){const e=process.argv.slice(2).reverse();const n={help:false,binary:false,short:false,base32:false};while(e.length>0){const t=e.pop();switch(t){case"--help":n.help=true;break;case"--short":n.short=true;break;case"--base32":n.base32=true;break;case"--binary":n.binary=true;break}}if(n.help){console.log(`trimid [--binary] [--short] [--base32] [--help]`);process.exit(0);return}const t=n.base32?32:62;const r=n.short?i.shortid(t):i.longid(t);process.stdout.write(n.binary?h(r):`${r}\n`);process.exit(0);return}if(typeof module!=="undefined"&&Object(module)===module){module.exports=i;return}if(typeof global!=="undefined"){global.TrimId=i;return}if(typeof window!=="undefined"){window.TrimId=i;return}})();
